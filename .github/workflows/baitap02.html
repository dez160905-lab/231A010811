<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài 2 - Todo List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #eef2ff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 2rem auto;
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .task-item {
            display: grid;
            grid-template-columns: 1fr auto auto; 
            gap: 1rem;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s ease;
        }

        .task-item:hover {
            background-color: #f9fafb;
        }

        #addTaskForm {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .task-text {
            word-break: break-word;
        }

        .completed .task-text {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .edit-input-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 0.5rem;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-indigo-700 mb-6 text-center">Todo List (LocalStorage)</h1>

        <form id="addTaskForm">
            <input type="text" id="taskInput" placeholder="Nhập task mới..." required
                   class="p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 w-full text-gray-700 shadow-sm">
            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-5 rounded-lg transition duration-150 ease-in-out shadow-md">
                Thêm Task
            </button>
        </form>

        <div id="taskList" class="space-y-2">
        </div>
    </div>

    <script>
        const taskInput = document.getElementById('taskInput');
        const taskList = document.getElementById('taskList');
        const addTaskForm = document.getElementById('addTaskForm');

        let todos = [];

        function saveTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
        }

        function loadTodos() {
            const storedTodos = localStorage.getItem('todos');
            if (storedTodos) {
                todos = JSON.parse(storedTodos);
            }
            renderTodos();
        }

        function renderTodos() {
            taskList.innerHTML = '';

            if (todos.length === 0) {
                taskList.innerHTML = '<p class="text-center text-gray-500 italic p-4 border rounded-lg">Chưa có task nào. Hãy thêm một task mới!</p>';
                return;
            }

            todos.forEach((todo, index) => {
                const taskItem = document.createElement('div');
                taskItem.className = `task-item rounded-lg ${todo.completed ? 'completed bg-green-50' : 'bg-white'}`;
                taskItem.setAttribute('data-index', index);

                const taskContent = document.createElement('div');
                taskContent.className = 'task-text cursor-pointer text-gray-800';
                taskContent.textContent = todo.text;
                taskContent.onclick = () => toggleComplete(index);

                const deleteButton = createButton('Xóa', 'bg-red-500 hover:bg-red-600', () => deleteTask(index));
                const editButton = createButton('Sửa', 'bg-yellow-500 hover:bg-yellow-600', () => editTask(index));

                taskItem.appendChild(taskContent);
                taskItem.appendChild(editButton);
                taskItem.appendChild(deleteButton);

                taskList.appendChild(taskItem);
            });
        }

        function createButton(text, colorClass, handler) {
            const button = document.createElement('button');
            button.textContent = text;
            button.className = `${colorClass} text-white font-medium py-1 px-3 rounded text-sm transition duration-150 ease-in-out shadow-sm w-16`;
            button.onclick = (e) => {
                e.stopPropagation();
                handler();
            };
            return button;
        }

        function addTask(event) {
            event.preventDefault();
            const text = taskInput.value.trim();
            if (text) {
                const newTask = {
                    id: Date.now(),
                    text: text,
                    completed: false
                };
                todos.push(newTask);
                saveTodos();
                taskInput.value = '';
                renderTodos();
            }
        }

        function deleteTask(index) {
            todos.splice(index, 1);
            saveTodos();
            renderTodos();
        }

        function toggleComplete(index) {
            todos[index].completed = !todos[index].completed;
            saveTodos();
            renderTodos();
        }

        function editTask(index) {
            const taskItem = taskList.querySelector(`[data-index="${index}"]`);
            if (!taskItem) return;

            const currentText = todos[index].text;
            const taskTextElement = taskItem.querySelector('.task-text');

            const editInputGroup = document.createElement('div');
            editInputGroup.className = 'edit-input-group';

            const editInput = document.createElement('input');
            editInput.type = 'text';
            editInput.value = currentText;
            editInput.className = 'p-2 border border-blue-400 rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full text-gray-700';

            const saveButton = createButton('Lưu', 'bg-blue-600 hover:bg-blue-700', () => saveEdit(index, editInput.value));

            editInputGroup.appendChild(editInput);
            editInputGroup.appendChild(saveButton);

            taskItem.replaceChild(editInputGroup, taskTextElement);
            
            taskItem.removeChild(taskItem.children[1]);
            taskItem.removeChild(taskItem.children[1]);

            editInput.focus();

            editInput.onkeypress = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit(index, editInput.value);
                }
            };
        }

        function saveEdit(index, newText) {
            const trimmedText = newText.trim();
            if (trimmedText) {
                todos[index].text = trimmedText;
                saveTodos();
                renderTodos();
            } else {
                deleteTask(index);
            }
        }

        addTaskForm.addEventListener('submit', addTask);
        document.addEventListener('DOMContentLoaded', loadTodos);
    </script>
</body>
</html>